<section class='tasks' *ngIf='(tasks$|async) as tasks'>
    <mat-toolbar>
        <h1>
            <ng-container *ngIf='state$|async as state'>
              {{state|taskState}}
            </ng-container>
            <span *ngIf='(tasks|tasksDuration:20000|formatDuration|async) as duration' class='state-duration'>
                ({{duration}})
            </span>
            <mat-select class='mat-body range-filter' [value]='rangeFilter' (selectionChange)='onRangeFilterChange($event.value)'>
                <mat-select-trigger>
                    <mat-icon class='filter-trigger-icon'>filter_list</mat-icon>
                </mat-select-trigger>
                <mat-option value="all">All</mat-option>
                <mat-option value="today">Today</mat-option>
                <mat-option value="yesterday">Yesterday</mat-option>
            </mat-select>
            <button
                *ngIf='(searchOpened$|async) === false'
                class='search-button'
                mat-icon-button
                (click)='searchOpened$.next(true)'
                matTooltip='Seach'
            ><mat-icon>search</mat-icon></button>
        </h1>
        <form class='search-form mat-body' *ngIf='searchOpened$|async' (submit)='$event.preventDefault();onSearchSubmit()'>
            <button
                type='button'
                mat-icon-button
                (click)='searchOpened$.next(false)'
                matTooltip='Close search'
            ><mat-icon>arrow_back</mat-icon></button>
            <mat-form-field>
                <input
                type="search"
                matInput
                placeholder='Search'
                name='search'
                [value]='(searchTerm$|async) || ""'
                (input)='searchTermInput$.next($event.target.value)'
                #searchInput
                (blur)='searchOpened$.next(false)'
                (keyup.esc)='searchOpened$.next(false)'
            ></mat-form-field>
        </form>
    </mat-toolbar>
    <button (click)='addTask()' mat-fab color='accent'>
        <mat-icon>add</mat-icon>
    </button>
    <ng-scrollbar>
        <cdk-virtual-scroll-viewport #scroll [itemSize]='48' scrollViewport >
            <mat-nav-list>
                <mat-list-item *ngFor='let task of tasks; trackBy taskId'>
                    <a
                        matLine
                        [routerLink]='[task.id]'
                        routerLinkActive='nav-link-active'
                        class='task-link'
                        #rla='routerLinkActive'
                        [scrollIntoViewIf]='rla.isActive'
                    >
                        <mat-icon>{{task|taskStateIcon}}</mat-icon>
                        <span class='name'>{{task.name}}</span>
                        <span class='duration'>{{task|taskDuration:5000|formatDuration|async}}</span>
                    </a>
                    <button-task-actions [task]='task'></button-task-actions>
                </mat-list-item>
            </mat-nav-list>
        </cdk-virtual-scroll-viewport>
    </ng-scrollbar>
</section>
<section class="task mat-app-background" *ngIf='taskOpened$|async'>
    <router-outlet></router-outlet>
</section>
